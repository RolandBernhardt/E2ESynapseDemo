{
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "factoryName": {
            "type": "string",
            "metadata": "Data Factory name",
            "defaultValue": "kpDemoADF"
        },
        "AzureDataLakeStorage1_accountKey": {
            "type": "secureString",
            "metadata": "Secure string for 'accountKey' of 'AzureDataLakeStorage1'"
        },
        "AzureSqlDB_connectionString": {
            "type": "secureString",
            "metadata": "Secure string for 'connectionString' of 'AzureSqlDB'"
        },
        "cmsdemopool_connectionString": {
            "type": "secureString",
            "metadata": "Secure string for 'connectionString' of 'cmsdemopool'"
        },
        "AzureDataLakeStorage1_properties_typeProperties_url": {
            "type": "string",
            "defaultValue": "https://cmsdemostorage.dfs.core.windows.net/"
        }
    },
    "variables": {
        "factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"
    },
    "resources": [
        {
            "name": "[concat(parameters('factoryName'), '/AzureDataLakeStorage1')]",
            "type": "Microsoft.DataFactory/factories/linkedServices",
            "apiVersion": "2018-06-01",
            "properties": {
                "annotations": [],
                "type": "AzureBlobFS",
                "typeProperties": {
                    "url": "[parameters('AzureDataLakeStorage1_properties_typeProperties_url')]",
                    "accountKey": {
                        "type": "SecureString",
                        "value": "[parameters('AzureDataLakeStorage1_accountKey')]"
                    }
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/AzureSqlDB')]",
            "type": "Microsoft.DataFactory/factories/linkedServices",
            "apiVersion": "2018-06-01",
            "properties": {
                "annotations": [],
                "type": "AzureSqlDatabase",
                "typeProperties": {
                    "connectionString": "[parameters('AzureSqlDB_connectionString')]"
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/cmsdemopool')]",
            "type": "Microsoft.DataFactory/factories/linkedServices",
            "apiVersion": "2018-06-01",
            "properties": {
                "annotations": [],
                "type": "AzureSqlDW",
                "typeProperties": {
                    "connectionString": "[parameters('cmsdemopool_connectionString')]"
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/Geography')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Geography",
                        "type": "ExecuteDataFlow",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "dataflow": {
                                "referenceName": "Geography",
                                "type": "DataFlowReference",
                                "parameters": {},
                                "datasetParameters": {
                                    "details2017": {},
                                    "details2016": {},
                                    "details2015": {},
                                    "details2014": {},
                                    "details2013": {},
                                    "States": {},
                                    "Output": {}
                                }
                            },
                            "staging": {},
                            "compute": {
                                "coreCount": 8,
                                "computeType": "General"
                            }
                        }
                    }
                ],
                "annotations": [],
                "lastPublishTime": "2020-09-23T05:12:32Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/dataflows/Geography')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/States')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "State",
                        "type": "ExecuteDataFlow",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "dataflow": {
                                "referenceName": "State",
                                "type": "DataFlowReference",
                                "parameters": {},
                                "datasetParameters": {
                                    "details2017": {},
                                    "details2016": {},
                                    "details2015": {},
                                    "details2014": {},
                                    "details2013": {},
                                    "Final": {}
                                }
                            },
                            "staging": {},
                            "compute": {
                                "coreCount": 8,
                                "computeType": "General"
                            }
                        }
                    }
                ],
                "annotations": [],
                "lastPublishTime": "2020-09-23T05:12:32Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/dataflows/State')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/Drug')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Drugs",
                        "type": "ExecuteDataFlow",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "dataflow": {
                                "referenceName": "Drugs",
                                "type": "DataFlowReference",
                                "parameters": {},
                                "datasetParameters": {
                                    "details2017": {},
                                    "details2016": {},
                                    "details2015": {},
                                    "details2014": {},
                                    "details2013": {},
                                    "Output": {}
                                }
                            },
                            "staging": {
                                "linkedService": {
                                    "referenceName": "AzureDataLakeStorage1",
                                    "type": "LinkedServiceReference"
                                },
                                "folderPath": "staging"
                            },
                            "compute": {
                                "coreCount": 8,
                                "computeType": "General"
                            }
                        }
                    }
                ],
                "annotations": [],
                "lastPublishTime": "2020-09-24T22:51:35Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/dataflows/Drugs')]",
                "[concat(variables('factoryId'), '/linkedServices/AzureDataLakeStorage1')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/Providers')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Providers",
                        "type": "ExecuteDataFlow",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "dataflow": {
                                "referenceName": "Providers",
                                "type": "DataFlowReference",
                                "parameters": {},
                                "datasetParameters": {
                                    "details2017": {},
                                    "details2016": {},
                                    "details2015": {},
                                    "details2014": {},
                                    "details2013": {},
                                    "Output": {}
                                }
                            },
                            "staging": {},
                            "compute": {
                                "coreCount": 8,
                                "computeType": "General"
                            }
                        }
                    }
                ],
                "annotations": [],
                "lastPublishTime": "2020-09-23T05:12:33Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/dataflows/Providers')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/Specialty')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Specialty",
                        "type": "ExecuteDataFlow",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "dataflow": {
                                "referenceName": "Specialty",
                                "type": "DataFlowReference",
                                "parameters": {},
                                "datasetParameters": {
                                    "details2017": {},
                                    "details2016": {},
                                    "details2015": {},
                                    "details2014": {},
                                    "details2013": {},
                                    "Output": {}
                                }
                            },
                            "staging": {},
                            "compute": {
                                "coreCount": 8,
                                "computeType": "General"
                            }
                        }
                    }
                ],
                "annotations": [],
                "lastPublishTime": "2020-09-23T05:12:33Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/dataflows/Specialty')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/Details')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Details",
                        "type": "ExecuteDataFlow",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "dataflow": {
                                "referenceName": "Details",
                                "type": "DataFlowReference",
                                "parameters": {},
                                "datasetParameters": {
                                    "details2017": {},
                                    "details2016": {},
                                    "details2015": {},
                                    "details2014": {},
                                    "details2013": {},
                                    "Geo": {},
                                    "Providers": {},
                                    "Specialty": {},
                                    "Drugs": {},
                                    "FinalDetails": {}
                                }
                            },
                            "staging": {},
                            "compute": {
                                "coreCount": 8,
                                "computeType": "General"
                            }
                        }
                    }
                ],
                "annotations": [],
                "lastPublishTime": "2020-09-23T05:12:34Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/dataflows/Details')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/details2016')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "AzureDataLakeStorage1",
                    "type": "LinkedServiceReference"
                },
                "annotations": [],
                "type": "DelimitedText",
                "typeProperties": {
                    "location": {
                        "type": "AzureBlobFSLocation",
                        "fileName": "PartD_Prescriber_PUF_NPI_Drug_16.txt",
                        "fileSystem": "cms-part-d-prescriber"
                    },
                    "columnDelimiter": "\t",
                    "encodingName": "WINDOWS-1252",
                    "escapeChar": "\\",
                    "firstRowAsHeader": true,
                    "quoteChar": "\""
                },
                "schema": [
                    {
                        "name": "npi",
                        "type": "String"
                    },
                    {
                        "name": "nppes_provider_last_org_name",
                        "type": "String"
                    },
                    {
                        "name": "nppes_provider_first_name",
                        "type": "String"
                    },
                    {
                        "name": "nppes_provider_city",
                        "type": "String"
                    },
                    {
                        "name": "nppes_provider_state",
                        "type": "String"
                    },
                    {
                        "name": "specialty_description",
                        "type": "String"
                    },
                    {
                        "name": "description_flag",
                        "type": "String"
                    },
                    {
                        "name": "drug_name",
                        "type": "String"
                    },
                    {
                        "name": "generic_name",
                        "type": "String"
                    },
                    {
                        "name": "bene_count",
                        "type": "String"
                    },
                    {
                        "name": "total_claim_count",
                        "type": "String"
                    },
                    {
                        "name": "total_30_day_fill_count",
                        "type": "String"
                    },
                    {
                        "name": "total_day_supply",
                        "type": "String"
                    },
                    {
                        "name": "total_drug_cost",
                        "type": "String"
                    },
                    {
                        "name": "bene_count_ge65",
                        "type": "String"
                    },
                    {
                        "name": "bene_count_ge65_suppress_flag",
                        "type": "String"
                    },
                    {
                        "name": "total_claim_count_ge65",
                        "type": "String"
                    },
                    {
                        "name": "ge65_suppress_flag",
                        "type": "String"
                    },
                    {
                        "name": "total_30_day_fill_count_ge65",
                        "type": "String"
                    },
                    {
                        "name": "total_day_supply_ge65",
                        "type": "String"
                    },
                    {
                        "name": "total_drug_cost_ge65",
                        "type": "String"
                    }
                ]
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureDataLakeStorage1')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/details2015')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "AzureDataLakeStorage1",
                    "type": "LinkedServiceReference"
                },
                "annotations": [],
                "type": "DelimitedText",
                "typeProperties": {
                    "location": {
                        "type": "AzureBlobFSLocation",
                        "fileName": "PartD_Prescriber_PUF_NPI_Drug_15.txt",
                        "fileSystem": "cms-part-d-prescriber"
                    },
                    "columnDelimiter": "\t",
                    "encodingName": "WINDOWS-1252",
                    "escapeChar": "\\",
                    "firstRowAsHeader": true,
                    "quoteChar": "\""
                },
                "schema": [
                    {
                        "name": "npi",
                        "type": "String"
                    },
                    {
                        "name": "nppes_provider_last_org_name",
                        "type": "String"
                    },
                    {
                        "name": "nppes_provider_first_name",
                        "type": "String"
                    },
                    {
                        "name": "nppes_provider_city",
                        "type": "String"
                    },
                    {
                        "name": "nppes_provider_state",
                        "type": "String"
                    },
                    {
                        "name": "specialty_description",
                        "type": "String"
                    },
                    {
                        "name": "description_flag",
                        "type": "String"
                    },
                    {
                        "name": "drug_name",
                        "type": "String"
                    },
                    {
                        "name": "generic_name",
                        "type": "String"
                    },
                    {
                        "name": "bene_count",
                        "type": "String"
                    },
                    {
                        "name": "total_claim_count",
                        "type": "String"
                    },
                    {
                        "name": "total_30_day_fill_count",
                        "type": "String"
                    },
                    {
                        "name": "total_day_supply",
                        "type": "String"
                    },
                    {
                        "name": "total_drug_cost",
                        "type": "String"
                    },
                    {
                        "name": "bene_count_ge65",
                        "type": "String"
                    },
                    {
                        "name": "bene_count_ge65_suppress_flag",
                        "type": "String"
                    },
                    {
                        "name": "total_claim_count_ge65",
                        "type": "String"
                    },
                    {
                        "name": "ge65_suppress_flag",
                        "type": "String"
                    },
                    {
                        "name": "total_30_day_fill_count_ge65",
                        "type": "String"
                    },
                    {
                        "name": "total_day_supply_ge65",
                        "type": "String"
                    },
                    {
                        "name": "total_drug_cost_ge65",
                        "type": "String"
                    }
                ]
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureDataLakeStorage1')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/AzureSqlDB_Specialty')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "AzureSqlDB",
                    "type": "LinkedServiceReference"
                },
                "annotations": [],
                "type": "AzureSqlTable",
                "schema": [
                    {
                        "name": "Specialty Description Flag",
                        "type": "varchar"
                    },
                    {
                        "name": "Year",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "YearSpecialtyKey",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "Specialty",
                        "type": "varchar"
                    }
                ],
                "typeProperties": {
                    "schema": "dbo",
                    "table": "Specialty"
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureSqlDB')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/AzureSqlDB_Providers')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "AzureSqlDB",
                    "type": "LinkedServiceReference"
                },
                "annotations": [],
                "type": "AzureSqlTable",
                "schema": [
                    {
                        "name": "npi",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "Last Name",
                        "type": "varchar"
                    },
                    {
                        "name": "First Name",
                        "type": "varchar"
                    },
                    {
                        "name": "Full Name",
                        "type": "varchar"
                    },
                    {
                        "name": "Year",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "YearNPI",
                        "type": "int",
                        "precision": 10
                    }
                ],
                "typeProperties": {
                    "schema": "dbo",
                    "table": "Providers"
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureSqlDB')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/details2013')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "AzureDataLakeStorage1",
                    "type": "LinkedServiceReference"
                },
                "annotations": [],
                "type": "DelimitedText",
                "typeProperties": {
                    "location": {
                        "type": "AzureBlobFSLocation",
                        "fileName": "PartD_Prescriber_PUF_NPI_Drug_13.txt",
                        "fileSystem": "cms-part-d-prescriber"
                    },
                    "columnDelimiter": "\t",
                    "encodingName": "WINDOWS-1252",
                    "escapeChar": "\\",
                    "firstRowAsHeader": true,
                    "quoteChar": "\""
                },
                "schema": [
                    {
                        "name": "npi",
                        "type": "String"
                    },
                    {
                        "name": "nppes_provider_last_org_name",
                        "type": "String"
                    },
                    {
                        "name": "nppes_provider_first_name",
                        "type": "String"
                    },
                    {
                        "name": "nppes_provider_city",
                        "type": "String"
                    },
                    {
                        "name": "nppes_provider_state",
                        "type": "String"
                    },
                    {
                        "name": "specialty_description",
                        "type": "String"
                    },
                    {
                        "name": "description_flag",
                        "type": "String"
                    },
                    {
                        "name": "drug_name",
                        "type": "String"
                    },
                    {
                        "name": "generic_name",
                        "type": "String"
                    },
                    {
                        "name": "bene_count",
                        "type": "String"
                    },
                    {
                        "name": "total_claim_count",
                        "type": "String"
                    },
                    {
                        "name": "total_30_day_fill_count",
                        "type": "String"
                    },
                    {
                        "name": "total_day_supply",
                        "type": "String"
                    },
                    {
                        "name": "total_drug_cost",
                        "type": "String"
                    },
                    {
                        "name": "bene_count_ge65",
                        "type": "String"
                    },
                    {
                        "name": "bene_count_ge65_suppress_flag",
                        "type": "String"
                    },
                    {
                        "name": "total_claim_count_ge65",
                        "type": "String"
                    },
                    {
                        "name": "ge65_suppress_flag",
                        "type": "String"
                    },
                    {
                        "name": "total_30_day_fill_count_ge65",
                        "type": "String"
                    },
                    {
                        "name": "total_day_supply_ge65",
                        "type": "String"
                    },
                    {
                        "name": "total_drug_cost_ge65",
                        "type": "String"
                    }
                ]
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureDataLakeStorage1')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/details2014')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "AzureDataLakeStorage1",
                    "type": "LinkedServiceReference"
                },
                "annotations": [],
                "type": "DelimitedText",
                "typeProperties": {
                    "location": {
                        "type": "AzureBlobFSLocation",
                        "fileName": "PartD_Prescriber_PUF_NPI_Drug_14.txt",
                        "fileSystem": "cms-part-d-prescriber"
                    },
                    "columnDelimiter": "\t",
                    "encodingName": "WINDOWS-1252",
                    "escapeChar": "\\",
                    "firstRowAsHeader": true,
                    "quoteChar": "\""
                },
                "schema": [
                    {
                        "name": "npi",
                        "type": "String"
                    },
                    {
                        "name": "nppes_provider_last_org_name",
                        "type": "String"
                    },
                    {
                        "name": "nppes_provider_first_name",
                        "type": "String"
                    },
                    {
                        "name": "nppes_provider_city",
                        "type": "String"
                    },
                    {
                        "name": "nppes_provider_state",
                        "type": "String"
                    },
                    {
                        "name": "specialty_description",
                        "type": "String"
                    },
                    {
                        "name": "description_flag",
                        "type": "String"
                    },
                    {
                        "name": "drug_name",
                        "type": "String"
                    },
                    {
                        "name": "generic_name",
                        "type": "String"
                    },
                    {
                        "name": "bene_count",
                        "type": "String"
                    },
                    {
                        "name": "total_claim_count",
                        "type": "String"
                    },
                    {
                        "name": "total_30_day_fill_count",
                        "type": "String"
                    },
                    {
                        "name": "total_day_supply",
                        "type": "String"
                    },
                    {
                        "name": "total_drug_cost",
                        "type": "String"
                    },
                    {
                        "name": "bene_count_ge65",
                        "type": "String"
                    },
                    {
                        "name": "bene_count_ge65_suppress_flag",
                        "type": "String"
                    },
                    {
                        "name": "total_claim_count_ge65",
                        "type": "String"
                    },
                    {
                        "name": "ge65_suppress_flag",
                        "type": "String"
                    },
                    {
                        "name": "total_30_day_fill_count_ge65",
                        "type": "String"
                    },
                    {
                        "name": "total_day_supply_ge65",
                        "type": "String"
                    },
                    {
                        "name": "total_drug_cost_ge65",
                        "type": "String"
                    }
                ]
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureDataLakeStorage1')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/AzureSqlDB_States')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "AzureSqlDB",
                    "type": "LinkedServiceReference"
                },
                "annotations": [],
                "type": "AzureSqlTable",
                "schema": [
                    {
                        "name": "State",
                        "type": "varchar"
                    },
                    {
                        "name": "StateKey",
                        "type": "int",
                        "precision": 10
                    }
                ],
                "typeProperties": {
                    "schema": "dbo",
                    "table": "States"
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureSqlDB')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/AzureSqlDB_Geo')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "AzureSqlDB",
                    "type": "LinkedServiceReference"
                },
                "annotations": [],
                "type": "AzureSqlTable",
                "schema": [
                    {
                        "name": "City",
                        "type": "varchar"
                    },
                    {
                        "name": "State",
                        "type": "varchar"
                    },
                    {
                        "name": "Year",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "YearGeoKey",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "City State",
                        "type": "varchar"
                    },
                    {
                        "name": "StateKey",
                        "type": "int",
                        "precision": 10
                    }
                ],
                "typeProperties": {
                    "schema": "dbo",
                    "table": "Geography"
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureSqlDB')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/details2017')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "AzureDataLakeStorage1",
                    "type": "LinkedServiceReference"
                },
                "annotations": [],
                "type": "DelimitedText",
                "typeProperties": {
                    "location": {
                        "type": "AzureBlobFSLocation",
                        "fileName": "PartD_Prescriber_PUF_NPI_Drug_17.txt",
                        "fileSystem": "cms-part-d-prescriber"
                    },
                    "columnDelimiter": "\t",
                    "encodingName": "WINDOWS-1252",
                    "escapeChar": "\\",
                    "firstRowAsHeader": true,
                    "quoteChar": "\""
                },
                "schema": [
                    {
                        "name": "npi",
                        "type": "String"
                    },
                    {
                        "name": "nppes_provider_last_org_name",
                        "type": "String"
                    },
                    {
                        "name": "nppes_provider_first_name",
                        "type": "String"
                    },
                    {
                        "name": "nppes_provider_city",
                        "type": "String"
                    },
                    {
                        "name": "nppes_provider_state",
                        "type": "String"
                    },
                    {
                        "name": "specialty_description",
                        "type": "String"
                    },
                    {
                        "name": "description_flag",
                        "type": "String"
                    },
                    {
                        "name": "drug_name",
                        "type": "String"
                    },
                    {
                        "name": "generic_name",
                        "type": "String"
                    },
                    {
                        "name": "bene_count",
                        "type": "String"
                    },
                    {
                        "name": "total_claim_count",
                        "type": "String"
                    },
                    {
                        "name": "total_30_day_fill_count",
                        "type": "String"
                    },
                    {
                        "name": "total_day_supply",
                        "type": "String"
                    },
                    {
                        "name": "total_drug_cost",
                        "type": "String"
                    },
                    {
                        "name": "bene_count_ge65",
                        "type": "String"
                    },
                    {
                        "name": "bene_count_ge65_suppress_flag",
                        "type": "String"
                    },
                    {
                        "name": "total_claim_count_ge65",
                        "type": "String"
                    },
                    {
                        "name": "ge65_suppress_flag",
                        "type": "String"
                    },
                    {
                        "name": "total_30_day_fill_count_ge65",
                        "type": "String"
                    },
                    {
                        "name": "total_day_supply_ge65",
                        "type": "String"
                    },
                    {
                        "name": "total_drug_cost_ge65",
                        "type": "String"
                    }
                ]
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureDataLakeStorage1')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/AzureSqlDB_Details')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "AzureSqlDB",
                    "type": "LinkedServiceReference"
                },
                "annotations": [],
                "type": "AzureSqlTable",
                "schema": [
                    {
                        "name": "BeneficiaryCount",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "TotalClaimCount",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "Total30DayFillCount",
                        "type": "decimal",
                        "precision": 10,
                        "scale": 2
                    },
                    {
                        "name": "TotalDaySupply",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "TotalDrugCost",
                        "type": "decimal",
                        "precision": 10,
                        "scale": 2
                    },
                    {
                        "name": "BeneCountGe65",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "BeneCountGe65SuppressFlag",
                        "type": "varchar"
                    },
                    {
                        "name": "TotalClaimCountGe65",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "Ge65SuppressFlag",
                        "type": "varchar"
                    },
                    {
                        "name": "Total30DayFillCountGe65",
                        "type": "decimal",
                        "precision": 10,
                        "scale": 2
                    },
                    {
                        "name": "TotalDrugCostGe65",
                        "type": "decimal",
                        "precision": 10,
                        "scale": 2
                    },
                    {
                        "name": "TotalDaySupplyGe65",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "Year",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "YearNPI",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "YearGeoKey",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "YearSpecialtyKey",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "YearDrugKey",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "CostPerDay",
                        "type": "decimal",
                        "precision": 10,
                        "scale": 2
                    }
                ],
                "typeProperties": {
                    "schema": "dbo",
                    "table": "Details"
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureSqlDB')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/AzureSqlDB_Drug')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "AzureSqlDB",
                    "type": "LinkedServiceReference"
                },
                "annotations": [],
                "type": "AzureSqlTable",
                "schema": [
                    {
                        "name": "Drug Name",
                        "type": "varchar"
                    },
                    {
                        "name": "Generic Name",
                        "type": "varchar"
                    },
                    {
                        "name": "Year",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "YearDrugKey",
                        "type": "int",
                        "precision": 10
                    }
                ],
                "typeProperties": {
                    "schema": "dbo",
                    "table": "Drugs"
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/AzureSqlDB')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/AzureSynapseDrugsTbl')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "cmsdemopool",
                    "type": "LinkedServiceReference"
                },
                "annotations": [],
                "type": "AzureSqlDWTable",
                "schema": [
                    {
                        "name": "DrugName",
                        "type": "varchar"
                    },
                    {
                        "name": "GenericName",
                        "type": "varchar"
                    },
                    {
                        "name": "Year",
                        "type": "int",
                        "precision": 10
                    },
                    {
                        "name": "YearDrugKey",
                        "type": "int",
                        "precision": 10
                    }
                ],
                "typeProperties": {
                    "schema": "dbo",
                    "table": "Drugs"
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/cmsdemopool')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/State')]",
            "type": "Microsoft.DataFactory/factories/dataflows",
            "apiVersion": "2018-06-01",
            "properties": {
                "type": "MappingDataFlow",
                "typeProperties": {
                    "sources": [
                        {
                            "dataset": {
                                "referenceName": "details2017",
                                "type": "DatasetReference"
                            },
                            "name": "details2017"
                        },
                        {
                            "dataset": {
                                "referenceName": "details2016",
                                "type": "DatasetReference"
                            },
                            "name": "details2016"
                        },
                        {
                            "dataset": {
                                "referenceName": "details2015",
                                "type": "DatasetReference"
                            },
                            "name": "details2015"
                        },
                        {
                            "dataset": {
                                "referenceName": "details2014",
                                "type": "DatasetReference"
                            },
                            "name": "details2014"
                        },
                        {
                            "dataset": {
                                "referenceName": "details2013",
                                "type": "DatasetReference"
                            },
                            "name": "details2013"
                        }
                    ],
                    "sinks": [
                        {
                            "dataset": {
                                "referenceName": "AzureSqlDB_States",
                                "type": "DatasetReference"
                            },
                            "name": "Final"
                        }
                    ],
                    "transformations": [
                        {
                            "name": "Unique2017"
                        },
                        {
                            "name": "Unique2016"
                        },
                        {
                            "name": "Unique2015"
                        },
                        {
                            "name": "Unique2014"
                        },
                        {
                            "name": "Unique2013"
                        },
                        {
                            "name": "Union1716"
                        },
                        {
                            "name": "Union171615"
                        },
                        {
                            "name": "Union17161514"
                        },
                        {
                            "name": "Union1716151413"
                        },
                        {
                            "name": "UniqueStates"
                        },
                        {
                            "name": "SelectStates"
                        },
                        {
                            "name": "StatesKey"
                        }
                    ],
                    "script": "source(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2017\nsource(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2016\nsource(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2015\nsource(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2014\nsource(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2013\ndetails2017 aggregate(groupBy(nppes_provider_state),\n\tCount = countDistinct(npi)) ~> Unique2017\ndetails2016 aggregate(groupBy(nppes_provider_state),\n\tCount = countDistinct(npi)) ~> Unique2016\ndetails2015 aggregate(groupBy(nppes_provider_state),\n\tCount = countDistinct(npi)) ~> Unique2015\ndetails2014 aggregate(groupBy(nppes_provider_state),\n\tCount = countDistinct(npi)) ~> Unique2014\ndetails2013 aggregate(groupBy(nppes_provider_state),\n\tCount = countDistinct(npi)) ~> Unique2013\nUnique2017, Unique2016 union(byName: true)~> Union1716\nUnion1716, Unique2015 union(byName: true)~> Union171615\nUnion171615, Unique2014 union(byName: true)~> Union17161514\nUnion17161514, Unique2013 union(byName: true)~> Union1716151413\nUnion1716151413 aggregate(groupBy(nppes_provider_state),\n\tCount = sum(Count)) ~> UniqueStates\nUniqueStates select(mapColumn(\n\t\tnppes_provider_state\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectStates\nSelectStates keyGenerate(output(StatesKey as long),\n\tstartAt: 1L) ~> StatesKey\nStatesKey sink(input(\n\t\tState as string,\n\t\tStateKey as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tmapColumn(\n\t\tState = nppes_provider_state,\n\t\tStateKey = StatesKey\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Final"
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/datasets/details2017')]",
                "[concat(variables('factoryId'), '/datasets/details2016')]",
                "[concat(variables('factoryId'), '/datasets/details2015')]",
                "[concat(variables('factoryId'), '/datasets/details2014')]",
                "[concat(variables('factoryId'), '/datasets/details2013')]",
                "[concat(variables('factoryId'), '/datasets/AzureSqlDB_States')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/Geography')]",
            "type": "Microsoft.DataFactory/factories/dataflows",
            "apiVersion": "2018-06-01",
            "properties": {
                "type": "MappingDataFlow",
                "typeProperties": {
                    "sources": [
                        {
                            "dataset": {
                                "referenceName": "details2017",
                                "type": "DatasetReference"
                            },
                            "name": "details2017"
                        },
                        {
                            "dataset": {
                                "referenceName": "details2016",
                                "type": "DatasetReference"
                            },
                            "name": "details2016"
                        },
                        {
                            "dataset": {
                                "referenceName": "details2015",
                                "type": "DatasetReference"
                            },
                            "name": "details2015"
                        },
                        {
                            "dataset": {
                                "referenceName": "details2014",
                                "type": "DatasetReference"
                            },
                            "name": "details2014"
                        },
                        {
                            "dataset": {
                                "referenceName": "details2013",
                                "type": "DatasetReference"
                            },
                            "name": "details2013"
                        },
                        {
                            "dataset": {
                                "referenceName": "AzureSqlDB_States",
                                "type": "DatasetReference"
                            },
                            "name": "States"
                        }
                    ],
                    "sinks": [
                        {
                            "dataset": {
                                "referenceName": "AzureSqlDB_Geo",
                                "type": "DatasetReference"
                            },
                            "name": "Output"
                        }
                    ],
                    "transformations": [
                        {
                            "name": "Unique2017"
                        },
                        {
                            "name": "Unique2016"
                        },
                        {
                            "name": "Unique2015"
                        },
                        {
                            "name": "Unique2014"
                        },
                        {
                            "name": "Unique2013"
                        },
                        {
                            "name": "Year2017"
                        },
                        {
                            "name": "Year2016"
                        },
                        {
                            "name": "Year2015"
                        },
                        {
                            "name": "Year2014"
                        },
                        {
                            "name": "Year2013"
                        },
                        {
                            "name": "Union1716"
                        },
                        {
                            "name": "Union171615"
                        },
                        {
                            "name": "Union17161514"
                        },
                        {
                            "name": "Union1716151413"
                        },
                        {
                            "name": "FinalColumns"
                        },
                        {
                            "name": "FinalDataTypes"
                        },
                        {
                            "name": "SurrogateKey"
                        },
                        {
                            "name": "DerivedColumn1"
                        },
                        {
                            "name": "AddStateKey"
                        }
                    ],
                    "script": "source(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2017\nsource(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2016\nsource(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2015\nsource(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2014\nsource(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2013\nsource(output(\n\t\tState as string,\n\t\tStateKey as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> States\ndetails2017 aggregate(groupBy(nppes_provider_city,\n\t\tnppes_provider_state),\n\tCount = countDistinct(npi)) ~> Unique2017\ndetails2016 aggregate(groupBy(nppes_provider_city,\n\t\tnppes_provider_state),\n\tCount = countDistinct(npi)) ~> Unique2016\ndetails2015 aggregate(groupBy(nppes_provider_city,\n\t\tnppes_provider_state),\n\tCount = countDistinct(npi)) ~> Unique2015\ndetails2014 aggregate(groupBy(nppes_provider_city,\n\t\tnppes_provider_state),\n\tCount = countDistinct(npi)) ~> Unique2014\ndetails2013 aggregate(groupBy(nppes_provider_city,\n\t\tnppes_provider_state),\n\tCount = countDistinct(npi)) ~> Unique2013\nUnique2017 derive(Year = \"2017\") ~> Year2017\nUnique2016 derive(Year = \"2016\") ~> Year2016\nUnique2015 derive(Year = \"2015\") ~> Year2015\nUnique2014 derive(Year = \"2014\") ~> Year2014\nUnique2013 derive(Year = \"2013\") ~> Year2013\nYear2017, Year2016 union(byName: true)~> Union1716\nUnion1716, Year2015 union(byName: true)~> Union171615\nUnion171615, Year2014 union(byName: true)~> Union17161514\nUnion17161514, Year2013 union(byName: true)~> Union1716151413\nAddStateKey select(mapColumn(\n\t\tnppes_provider_city,\n\t\tnppes_provider_state,\n\t\tYear,\n\t\tStateKey\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> FinalColumns\nSurrogateKey derive(Year = toInteger(Year)) ~> FinalDataTypes\nDerivedColumn1 keyGenerate(output(YearGeoKey as long),\n\tstartAt: 1L) ~> SurrogateKey\nFinalColumns derive(YearGeo = concat(Year,nppes_provider_city,nppes_provider_state),\n\t\tCityState = nppes_provider_city + ', ' + nppes_provider_state) ~> DerivedColumn1\nUnion1716151413, States join(nppes_provider_state == State,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> AddStateKey\nFinalDataTypes sink(input(\n\t\tCity as string,\n\t\tState as string,\n\t\tYear as integer,\n\t\tYearGeoKey as integer,\n\t\t{City State} as string,\n\t\tStateKey as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: true,\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tmapColumn(\n\t\tCity = nppes_provider_city,\n\t\tState = nppes_provider_state,\n\t\tYear,\n\t\t{City State} = CityState,\n\t\tYearGeoKey,\n\t\tStateKey\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Output"
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/datasets/details2017')]",
                "[concat(variables('factoryId'), '/datasets/details2016')]",
                "[concat(variables('factoryId'), '/datasets/details2015')]",
                "[concat(variables('factoryId'), '/datasets/details2014')]",
                "[concat(variables('factoryId'), '/datasets/details2013')]",
                "[concat(variables('factoryId'), '/datasets/AzureSqlDB_States')]",
                "[concat(variables('factoryId'), '/datasets/AzureSqlDB_Geo')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/Specialty')]",
            "type": "Microsoft.DataFactory/factories/dataflows",
            "apiVersion": "2018-06-01",
            "properties": {
                "type": "MappingDataFlow",
                "typeProperties": {
                    "sources": [
                        {
                            "dataset": {
                                "referenceName": "details2017",
                                "type": "DatasetReference"
                            },
                            "name": "details2017"
                        },
                        {
                            "dataset": {
                                "referenceName": "details2016",
                                "type": "DatasetReference"
                            },
                            "name": "details2016"
                        },
                        {
                            "dataset": {
                                "referenceName": "details2015",
                                "type": "DatasetReference"
                            },
                            "name": "details2015"
                        },
                        {
                            "dataset": {
                                "referenceName": "details2014",
                                "type": "DatasetReference"
                            },
                            "name": "details2014"
                        },
                        {
                            "dataset": {
                                "referenceName": "details2013",
                                "type": "DatasetReference"
                            },
                            "name": "details2013"
                        }
                    ],
                    "sinks": [
                        {
                            "dataset": {
                                "referenceName": "AzureSqlDB_Specialty",
                                "type": "DatasetReference"
                            },
                            "name": "Output"
                        }
                    ],
                    "transformations": [
                        {
                            "name": "Unique2017"
                        },
                        {
                            "name": "Unique2016"
                        },
                        {
                            "name": "Unique2015"
                        },
                        {
                            "name": "Unique2014"
                        },
                        {
                            "name": "Unique2013"
                        },
                        {
                            "name": "Year2017"
                        },
                        {
                            "name": "Year2016"
                        },
                        {
                            "name": "Year2015"
                        },
                        {
                            "name": "Year2014"
                        },
                        {
                            "name": "Year2013"
                        },
                        {
                            "name": "Union1716"
                        },
                        {
                            "name": "Union171615"
                        },
                        {
                            "name": "Union17161514"
                        },
                        {
                            "name": "Union1716151413"
                        },
                        {
                            "name": "FinalColumns"
                        },
                        {
                            "name": "FinalDataTypes"
                        },
                        {
                            "name": "SurrogateKey"
                        },
                        {
                            "name": "DerivedColumn1"
                        }
                    ],
                    "script": "source(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2017\nsource(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2016\nsource(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2015\nsource(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2014\nsource(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2013\ndetails2017 aggregate(groupBy(specialty_description,\n\t\tdescription_flag),\n\tCount = countDistinct(npi)) ~> Unique2017\ndetails2016 aggregate(groupBy(specialty_description,\n\t\tdescription_flag),\n\tCount = countDistinct(npi)) ~> Unique2016\ndetails2015 aggregate(groupBy(specialty_description,\n\t\tdescription_flag),\n\tCount = countDistinct(npi)) ~> Unique2015\ndetails2014 aggregate(groupBy(specialty_description,\n\t\tdescription_flag),\n\tCount = countDistinct(npi)) ~> Unique2014\ndetails2013 aggregate(groupBy(specialty_description,\n\t\tdescription_flag),\n\tCount = countDistinct(npi)) ~> Unique2013\nUnique2017 derive(Year = \"2017\") ~> Year2017\nUnique2016 derive(Year = \"2016\") ~> Year2016\nUnique2015 derive(Year = \"2015\") ~> Year2015\nUnique2014 derive(Year = \"2014\") ~> Year2014\nUnique2013 derive(Year = \"2013\") ~> Year2013\nYear2017, Year2016 union(byName: true)~> Union1716\nUnion1716, Year2015 union(byName: true)~> Union171615\nUnion171615, Year2014 union(byName: true)~> Union17161514\nUnion17161514, Year2013 union(byName: true)~> Union1716151413\nUnion1716151413 select(mapColumn(\n\t\tspecialty_description,\n\t\tdescription_flag,\n\t\tYear\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> FinalColumns\nSurrogateKey derive(Year = toInteger(Year)) ~> FinalDataTypes\nDerivedColumn1 keyGenerate(output(YearSpecialtyKey as long),\n\tstartAt: 1L) ~> SurrogateKey\nFinalColumns derive(YearSpecialty = Year + specialty_description + \"|\" + description_flag) ~> DerivedColumn1\nFinalDataTypes sink(input(\n\t\t{Specialty Description Flag} as string,\n\t\tYear as integer,\n\t\tYearSpecialtyKey as integer,\n\t\tSpecialty as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: true,\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tmapColumn(\n\t\tSpecialty = specialty_description,\n\t\t{Specialty Description Flag} = description_flag,\n\t\tYear,\n\t\tYearSpecialtyKey\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Output"
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/datasets/details2017')]",
                "[concat(variables('factoryId'), '/datasets/details2016')]",
                "[concat(variables('factoryId'), '/datasets/details2015')]",
                "[concat(variables('factoryId'), '/datasets/details2014')]",
                "[concat(variables('factoryId'), '/datasets/details2013')]",
                "[concat(variables('factoryId'), '/datasets/AzureSqlDB_Specialty')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/Details')]",
            "type": "Microsoft.DataFactory/factories/dataflows",
            "apiVersion": "2018-06-01",
            "properties": {
                "type": "MappingDataFlow",
                "typeProperties": {
                    "sources": [
                        {
                            "dataset": {
                                "referenceName": "details2017",
                                "type": "DatasetReference"
                            },
                            "name": "details2017"
                        },
                        {
                            "dataset": {
                                "referenceName": "details2016",
                                "type": "DatasetReference"
                            },
                            "name": "details2016"
                        },
                        {
                            "dataset": {
                                "referenceName": "details2015",
                                "type": "DatasetReference"
                            },
                            "name": "details2015"
                        },
                        {
                            "dataset": {
                                "referenceName": "details2014",
                                "type": "DatasetReference"
                            },
                            "name": "details2014"
                        },
                        {
                            "dataset": {
                                "referenceName": "details2013",
                                "type": "DatasetReference"
                            },
                            "name": "details2013"
                        },
                        {
                            "dataset": {
                                "referenceName": "AzureSqlDB_Geo",
                                "type": "DatasetReference"
                            },
                            "name": "Geo"
                        },
                        {
                            "dataset": {
                                "referenceName": "AzureSqlDB_Providers",
                                "type": "DatasetReference"
                            },
                            "name": "Providers"
                        },
                        {
                            "dataset": {
                                "referenceName": "AzureSqlDB_Specialty",
                                "type": "DatasetReference"
                            },
                            "name": "Specialty"
                        },
                        {
                            "dataset": {
                                "referenceName": "AzureSqlDB_Drug",
                                "type": "DatasetReference"
                            },
                            "name": "Drugs"
                        }
                    ],
                    "sinks": [
                        {
                            "dataset": {
                                "referenceName": "AzureSqlDB_Details",
                                "type": "DatasetReference"
                            },
                            "name": "FinalDetails"
                        }
                    ],
                    "transformations": [
                        {
                            "name": "Year2017"
                        },
                        {
                            "name": "Year2016"
                        },
                        {
                            "name": "Year2015"
                        },
                        {
                            "name": "Year2014"
                        },
                        {
                            "name": "Year2013"
                        },
                        {
                            "name": "Union1716"
                        },
                        {
                            "name": "Union171615"
                        },
                        {
                            "name": "Union17161514"
                        },
                        {
                            "name": "Union1716151413"
                        },
                        {
                            "name": "JoinProviders"
                        },
                        {
                            "name": "YearInt"
                        },
                        {
                            "name": "SelectProviders"
                        },
                        {
                            "name": "JoinGeo"
                        },
                        {
                            "name": "SelectGeo"
                        },
                        {
                            "name": "JoinSpecialty"
                        },
                        {
                            "name": "SelectSpecialty"
                        },
                        {
                            "name": "JoinDrugs"
                        },
                        {
                            "name": "SelectDrugs"
                        },
                        {
                            "name": "DataTypes"
                        },
                        {
                            "name": "AddCostPerDay"
                        }
                    ],
                    "script": "source(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2017\nsource(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2016\nsource(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2015\nsource(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2014\nsource(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2013\nsource(output(\n\t\tCity as string,\n\t\tState as string,\n\t\tYear as integer,\n\t\tYearGeoKey as integer,\n\t\t{City State} as string,\n\t\tStateKey as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> Geo\nsource(output(\n\t\tnpi as integer,\n\t\t{Last Name} as string,\n\t\t{First Name} as string,\n\t\t{Full Name} as string,\n\t\tYear as integer,\n\t\tYearNPI as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> Providers\nsource(output(\n\t\t{Specialty Description Flag} as string,\n\t\tYear as integer,\n\t\tYearSpecialtyKey as integer,\n\t\tSpecialty as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> Specialty\nsource(output(\n\t\t{Drug Name} as string,\n\t\t{Generic Name} as string,\n\t\tYear as integer,\n\t\tYearDrugKey as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> Drugs\ndetails2017 derive(Year = \"2017\") ~> Year2017\ndetails2016 derive(Year = \"2016\") ~> Year2016\ndetails2015 derive(Year = \"2015\") ~> Year2015\ndetails2014 derive(Year = \"2014\") ~> Year2014\ndetails2013 derive(Year = \"2013\") ~> Year2013\nYear2017, Year2016 union(byName: true)~> Union1716\nUnion1716, Year2015 union(byName: true)~> Union171615\nUnion171615, Year2014 union(byName: true)~> Union17161514\nUnion17161514, Year2013 union(byName: true)~> Union1716151413\nYearInt, Providers join(YearInt@npi == Providers@npi\n\t&& YearInt@Year == Providers@Year,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> JoinProviders\nUnion1716151413 derive(Year = toInteger(Year),\n\t\tnpi = toInteger(npi)) ~> YearInt\nJoinProviders select(mapColumn(\n\t\tnppes_provider_city,\n\t\tnppes_provider_state,\n\t\tspecialty_description,\n\t\tdescription_flag,\n\t\tdrug_name,\n\t\tgeneric_name,\n\t\tbene_count,\n\t\ttotal_claim_count,\n\t\ttotal_30_day_fill_count,\n\t\ttotal_day_supply,\n\t\ttotal_drug_cost,\n\t\tbene_count_ge65,\n\t\tbene_count_ge65_suppress_flag,\n\t\ttotal_claim_count_ge65,\n\t\tge65_suppress_flag,\n\t\ttotal_30_day_fill_count_ge65,\n\t\ttotal_day_supply_ge65,\n\t\ttotal_drug_cost_ge65,\n\t\tYear = YearInt@Year,\n\t\tYearNPI\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectProviders\nSelectProviders, Geo join(nppes_provider_city == City\n\t&& nppes_provider_state == State\n\t&& SelectProviders@Year == Geo@Year,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> JoinGeo\nJoinGeo select(mapColumn(\n\t\tspecialty_description,\n\t\tdescription_flag,\n\t\tdrug_name,\n\t\tgeneric_name,\n\t\tbene_count,\n\t\ttotal_claim_count,\n\t\ttotal_30_day_fill_count,\n\t\ttotal_day_supply,\n\t\ttotal_drug_cost,\n\t\tbene_count_ge65,\n\t\tbene_count_ge65_suppress_flag,\n\t\ttotal_claim_count_ge65,\n\t\tge65_suppress_flag,\n\t\ttotal_30_day_fill_count_ge65,\n\t\ttotal_day_supply_ge65,\n\t\ttotal_drug_cost_ge65,\n\t\tYear = SelectProviders@Year,\n\t\tYearNPI,\n\t\tYearGeoKey\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectGeo\nSelectGeo, Specialty join(specialty_description == Specialty\n\t&& description_flag == {Specialty Description Flag}\n\t&& SelectGeo@Year == Specialty@Year,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> JoinSpecialty\nJoinSpecialty select(mapColumn(\n\t\tdrug_name,\n\t\tgeneric_name,\n\t\tbene_count,\n\t\ttotal_claim_count,\n\t\ttotal_30_day_fill_count,\n\t\ttotal_day_supply,\n\t\ttotal_drug_cost,\n\t\tbene_count_ge65,\n\t\tbene_count_ge65_suppress_flag,\n\t\ttotal_claim_count_ge65,\n\t\tge65_suppress_flag,\n\t\ttotal_30_day_fill_count_ge65,\n\t\ttotal_day_supply_ge65,\n\t\ttotal_drug_cost_ge65,\n\t\tYear = SelectGeo@Year,\n\t\tYearNPI,\n\t\tYearGeoKey,\n\t\tYearSpecialtyKey\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectSpecialty\nSelectSpecialty, Drugs join(drug_name == {Drug Name}\n\t&& generic_name == {Generic Name}\n\t&& SelectSpecialty@Year == Drugs@Year,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> JoinDrugs\nJoinDrugs select(mapColumn(\n\t\tbene_count,\n\t\ttotal_claim_count,\n\t\ttotal_30_day_fill_count,\n\t\ttotal_day_supply,\n\t\ttotal_drug_cost,\n\t\tbene_count_ge65,\n\t\tbene_count_ge65_suppress_flag,\n\t\ttotal_claim_count_ge65,\n\t\tge65_suppress_flag,\n\t\ttotal_30_day_fill_count_ge65,\n\t\ttotal_day_supply_ge65,\n\t\ttotal_drug_cost_ge65,\n\t\tYear = SelectSpecialty@Year,\n\t\tYearNPI,\n\t\tYearGeoKey,\n\t\tYearSpecialtyKey,\n\t\tYearDrugKey\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectDrugs\nSelectDrugs derive(bene_count = toInteger(bene_count),\n\t\ttotal_claim_count = toInteger(total_claim_count),\n\t\ttotal_30_day_fill_count = toDecimal(total_30_day_fill_count),\n\t\ttotal_day_supply = toInteger(total_day_supply),\n\t\ttotal_drug_cost = toDecimal(total_drug_cost),\n\t\tbene_count_ge65 = toInteger(bene_count_ge65),\n\t\ttotal_claim_count_ge65 = toInteger(total_claim_count_ge65),\n\t\ttotal_30_day_fill_count_ge65 = toDecimal(total_30_day_fill_count_ge65),\n\t\ttotal_drug_cost_ge65 = toDecimal(total_drug_cost_ge65),\n\t\ttotal_day_supply_ge65 = toInteger(total_day_supply_ge65)) ~> DataTypes\nDataTypes derive(CostPerDayRowLevel = divide(total_drug_cost,total_day_supply)) ~> AddCostPerDay\nAddCostPerDay sink(input(\n\t\tBeneficiaryCount as integer,\n\t\tTotalClaimCount as integer,\n\t\tTotal30DayFillCount as decimal(10,2),\n\t\tTotalDaySupply as integer,\n\t\tTotalDrugCost as decimal(10,2),\n\t\tBeneCountGe65 as integer,\n\t\tBeneCountGe65SuppressFlag as string,\n\t\tTotalClaimCountGe65 as integer,\n\t\tGe65SuppressFlag as string,\n\t\tTotal30DayFillCountGe65 as decimal(10,2),\n\t\tTotalDrugCostGe65 as decimal(10,2),\n\t\tTotalDaySupplyGe65 as integer,\n\t\tYear as integer,\n\t\tYearNPI as integer,\n\t\tYearGeoKey as integer,\n\t\tYearSpecialtyKey as integer,\n\t\tYearDrugKey as integer,\n\t\tCostPerDay as decimal(10,2)\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tmapColumn(\n\t\tBeneficiaryCount = bene_count,\n\t\tTotalClaimCount = total_claim_count,\n\t\tTotal30DayFillCount = total_30_day_fill_count,\n\t\tTotalDaySupply = total_day_supply,\n\t\tTotalDrugCost = total_drug_cost,\n\t\tBeneCountGe65 = bene_count_ge65,\n\t\tBeneCountGe65SuppressFlag = bene_count_ge65_suppress_flag,\n\t\tTotalClaimCountGe65 = total_claim_count_ge65,\n\t\tGe65SuppressFlag = ge65_suppress_flag,\n\t\tTotal30DayFillCountGe65 = total_30_day_fill_count_ge65,\n\t\tTotalDrugCostGe65 = total_drug_cost_ge65,\n\t\tTotalDaySupplyGe65 = total_day_supply_ge65,\n\t\tYear,\n\t\tYearNPI,\n\t\tYearGeoKey,\n\t\tYearSpecialtyKey,\n\t\tYearDrugKey,\n\t\tCostPerDay = CostPerDayRowLevel\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> FinalDetails"
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/datasets/details2017')]",
                "[concat(variables('factoryId'), '/datasets/details2016')]",
                "[concat(variables('factoryId'), '/datasets/details2015')]",
                "[concat(variables('factoryId'), '/datasets/details2014')]",
                "[concat(variables('factoryId'), '/datasets/details2013')]",
                "[concat(variables('factoryId'), '/datasets/AzureSqlDB_Geo')]",
                "[concat(variables('factoryId'), '/datasets/AzureSqlDB_Providers')]",
                "[concat(variables('factoryId'), '/datasets/AzureSqlDB_Specialty')]",
                "[concat(variables('factoryId'), '/datasets/AzureSqlDB_Drug')]",
                "[concat(variables('factoryId'), '/datasets/AzureSqlDB_Details')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/Drugs')]",
            "type": "Microsoft.DataFactory/factories/dataflows",
            "apiVersion": "2018-06-01",
            "properties": {
                "type": "MappingDataFlow",
                "typeProperties": {
                    "sources": [
                        {
                            "dataset": {
                                "referenceName": "details2017",
                                "type": "DatasetReference"
                            },
                            "name": "details2017"
                        },
                        {
                            "dataset": {
                                "referenceName": "details2016",
                                "type": "DatasetReference"
                            },
                            "name": "details2016"
                        },
                        {
                            "dataset": {
                                "referenceName": "details2015",
                                "type": "DatasetReference"
                            },
                            "name": "details2015"
                        },
                        {
                            "dataset": {
                                "referenceName": "details2014",
                                "type": "DatasetReference"
                            },
                            "name": "details2014"
                        },
                        {
                            "dataset": {
                                "referenceName": "details2013",
                                "type": "DatasetReference"
                            },
                            "name": "details2013"
                        }
                    ],
                    "sinks": [
                        {
                            "dataset": {
                                "referenceName": "AzureSynapseDrugsTbl",
                                "type": "DatasetReference"
                            },
                            "name": "Output"
                        }
                    ],
                    "transformations": [
                        {
                            "name": "Unique2017"
                        },
                        {
                            "name": "Unique2016"
                        },
                        {
                            "name": "Unique2015"
                        },
                        {
                            "name": "Unique2014"
                        },
                        {
                            "name": "Unique2013"
                        },
                        {
                            "name": "Year2017"
                        },
                        {
                            "name": "Year2016"
                        },
                        {
                            "name": "Year2015"
                        },
                        {
                            "name": "Year2014"
                        },
                        {
                            "name": "Year2013"
                        },
                        {
                            "name": "Union1716"
                        },
                        {
                            "name": "Union171615"
                        },
                        {
                            "name": "Union17161514"
                        },
                        {
                            "name": "Union1716151413"
                        },
                        {
                            "name": "FinalColumns"
                        },
                        {
                            "name": "FinalDataTypes"
                        },
                        {
                            "name": "SurrogateKey"
                        },
                        {
                            "name": "DerivedColumn1"
                        }
                    ],
                    "script": "source(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2017\nsource(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2016\nsource(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2015\nsource(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2014\nsource(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2013\ndetails2017 aggregate(groupBy(drug_name,\n\t\tgeneric_name),\n\tCount = countDistinct(npi)) ~> Unique2017\ndetails2016 aggregate(groupBy(drug_name,\n\t\tgeneric_name),\n\tCount = countDistinct(npi)) ~> Unique2016\ndetails2015 aggregate(groupBy(drug_name,\n\t\tgeneric_name),\n\tCount = countDistinct(npi)) ~> Unique2015\ndetails2014 aggregate(groupBy(drug_name,\n\t\tgeneric_name),\n\tCount = countDistinct(npi)) ~> Unique2014\ndetails2013 aggregate(groupBy(drug_name,\n\t\tgeneric_name),\n\tCount = countDistinct(npi)) ~> Unique2013\nUnique2017 derive(Year = \"2017\") ~> Year2017\nUnique2016 derive(Year = \"2016\") ~> Year2016\nUnique2015 derive(Year = \"2015\") ~> Year2015\nUnique2014 derive(Year = \"2014\") ~> Year2014\nUnique2013 derive(Year = \"2013\") ~> Year2013\nYear2017, Year2016 union(byName: true)~> Union1716\nUnion1716, Year2015 union(byName: true)~> Union171615\nUnion171615, Year2014 union(byName: true)~> Union17161514\nUnion17161514, Year2013 union(byName: true)~> Union1716151413\nUnion1716151413 select(mapColumn(\n\t\tdrug_name,\n\t\tgeneric_name,\n\t\tYear\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> FinalColumns\nSurrogateKey derive(Year = toInteger(Year)) ~> FinalDataTypes\nDerivedColumn1 keyGenerate(output(YearDrug as long),\n\tstartAt: 1L) ~> SurrogateKey\nFinalColumns derive(YearDrug = Year + drug_name + \"|\" + generic_name) ~> DerivedColumn1\nFinalDataTypes sink(input(\n\t\tDrugName as string,\n\t\tGenericName as string,\n\t\tYear as integer,\n\t\tYearDrugKey as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: true,\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tstaged: true,\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Output"
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/datasets/details2017')]",
                "[concat(variables('factoryId'), '/datasets/details2016')]",
                "[concat(variables('factoryId'), '/datasets/details2015')]",
                "[concat(variables('factoryId'), '/datasets/details2014')]",
                "[concat(variables('factoryId'), '/datasets/details2013')]",
                "[concat(variables('factoryId'), '/datasets/AzureSynapseDrugsTbl')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/Providers')]",
            "type": "Microsoft.DataFactory/factories/dataflows",
            "apiVersion": "2018-06-01",
            "properties": {
                "type": "MappingDataFlow",
                "typeProperties": {
                    "sources": [
                        {
                            "dataset": {
                                "referenceName": "details2017",
                                "type": "DatasetReference"
                            },
                            "name": "details2017"
                        },
                        {
                            "dataset": {
                                "referenceName": "details2016",
                                "type": "DatasetReference"
                            },
                            "name": "details2016"
                        },
                        {
                            "dataset": {
                                "referenceName": "details2015",
                                "type": "DatasetReference"
                            },
                            "name": "details2015"
                        },
                        {
                            "dataset": {
                                "referenceName": "details2014",
                                "type": "DatasetReference"
                            },
                            "name": "details2014"
                        },
                        {
                            "dataset": {
                                "referenceName": "details2013",
                                "type": "DatasetReference"
                            },
                            "name": "details2013"
                        }
                    ],
                    "sinks": [
                        {
                            "dataset": {
                                "referenceName": "AzureSqlDB_Providers",
                                "type": "DatasetReference"
                            },
                            "name": "Output"
                        }
                    ],
                    "transformations": [
                        {
                            "name": "Unique2017"
                        },
                        {
                            "name": "Unique2016"
                        },
                        {
                            "name": "Unique2015"
                        },
                        {
                            "name": "Unique2014"
                        },
                        {
                            "name": "Unique2013"
                        },
                        {
                            "name": "Year2017"
                        },
                        {
                            "name": "Year2016"
                        },
                        {
                            "name": "Year2015"
                        },
                        {
                            "name": "Year2014"
                        },
                        {
                            "name": "Year2013"
                        },
                        {
                            "name": "Union1716"
                        },
                        {
                            "name": "Union171615"
                        },
                        {
                            "name": "Union17161514"
                        },
                        {
                            "name": "Union1716151413"
                        },
                        {
                            "name": "FinalColumns"
                        },
                        {
                            "name": "FinalDataTypes"
                        },
                        {
                            "name": "SurrogateKey"
                        },
                        {
                            "name": "DerivedColumn1"
                        }
                    ],
                    "script": "source(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2017\nsource(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2016\nsource(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2015\nsource(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2014\nsource(output(\n\t\tnpi as string,\n\t\tnppes_provider_last_org_name as string,\n\t\tnppes_provider_first_name as string,\n\t\tnppes_provider_city as string,\n\t\tnppes_provider_state as string,\n\t\tspecialty_description as string,\n\t\tdescription_flag as string,\n\t\tdrug_name as string,\n\t\tgeneric_name as string,\n\t\tbene_count as string,\n\t\ttotal_claim_count as string,\n\t\ttotal_30_day_fill_count as string,\n\t\ttotal_day_supply as string,\n\t\ttotal_drug_cost as string,\n\t\tbene_count_ge65 as string,\n\t\tbene_count_ge65_suppress_flag as string,\n\t\ttotal_claim_count_ge65 as string,\n\t\tge65_suppress_flag as string,\n\t\ttotal_30_day_fill_count_ge65 as string,\n\t\ttotal_day_supply_ge65 as string,\n\t\ttotal_drug_cost_ge65 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> details2013\ndetails2017 aggregate(groupBy(npi,\n\t\tnppes_provider_last_org_name,\n\t\tnppes_provider_first_name),\n\tCount = countDistinct(npi)) ~> Unique2017\ndetails2016 aggregate(groupBy(npi,\n\t\tnppes_provider_last_org_name,\n\t\tnppes_provider_first_name),\n\tCount = countDistinct(npi)) ~> Unique2016\ndetails2015 aggregate(groupBy(npi,\n\t\tnppes_provider_last_org_name,\n\t\tnppes_provider_first_name),\n\tCount = countDistinct(npi)) ~> Unique2015\ndetails2014 aggregate(groupBy(npi,\n\t\tnppes_provider_last_org_name,\n\t\tnppes_provider_first_name),\n\tCount = countDistinct(npi)) ~> Unique2014\ndetails2013 aggregate(groupBy(npi,\n\t\tnppes_provider_last_org_name,\n\t\tnppes_provider_first_name),\n\tCount = countDistinct(npi)) ~> Unique2013\nUnique2017 derive(Year = \"2017\") ~> Year2017\nUnique2016 derive(Year = \"2016\") ~> Year2016\nUnique2015 derive(Year = \"2015\") ~> Year2015\nUnique2014 derive(Year = \"2014\") ~> Year2014\nUnique2013 derive(Year = \"2013\") ~> Year2013\nYear2017, Year2016 union(byName: true)~> Union1716\nUnion1716, Year2015 union(byName: true)~> Union171615\nUnion171615, Year2014 union(byName: true)~> Union17161514\nUnion17161514, Year2013 union(byName: true)~> Union1716151413\nUnion1716151413 select(mapColumn(\n\t\tnpi,\n\t\tnppes_provider_last_org_name,\n\t\tnppes_provider_first_name,\n\t\tYear\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> FinalColumns\nSurrogateKey derive(npi = toInteger(npi),\n\t\tYear = toInteger(Year)) ~> FinalDataTypes\nDerivedColumn1 keyGenerate(output(YearNPI as long),\n\tstartAt: 1L) ~> SurrogateKey\nFinalColumns derive(YearNPI = concat(Year,npi),\n\t\tFullName = nppes_provider_last_org_name + ', ' + nppes_provider_first_name) ~> DerivedColumn1\nFinalDataTypes sink(input(\n\t\tnpi as integer,\n\t\t{Last Name} as string,\n\t\t{First Name} as string,\n\t\t{Full Name} as string,\n\t\tYear as integer,\n\t\tYearNPI as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: true,\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tmapColumn(\n\t\tnpi,\n\t\t{Last Name} = nppes_provider_last_org_name,\n\t\t{First Name} = nppes_provider_first_name,\n\t\tYear,\n\t\tYearNPI,\n\t\t{Full Name} = FullName\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Output"
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/datasets/details2017')]",
                "[concat(variables('factoryId'), '/datasets/details2016')]",
                "[concat(variables('factoryId'), '/datasets/details2015')]",
                "[concat(variables('factoryId'), '/datasets/details2014')]",
                "[concat(variables('factoryId'), '/datasets/details2013')]",
                "[concat(variables('factoryId'), '/datasets/AzureSqlDB_Providers')]"
            ]
        }
    ]
}